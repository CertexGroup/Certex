<body>
</body>

<template name="createCertificate">
    {{>nav}}

  <div class="container">
    <h2>Create Certificate</h2>
    <div class="row">
        <form class="new-cert col s12">
            <div class="row">
              {{#each authority}}
                {{> publicKeyInput}}
              {{/each}}
            </div>
            <div class="row">
              {{> privateKeyInput}}
            </div>
            <div class="row">
              <div class="input-field col s12 m6">
                <select name="certTitleDropdown">
                  <option value="0">Select One</option>
                  {{#each certificateTemplates}}
                    {{> certificateTemplate}}
                  {{/each}}
                </select>
              <label>Title</label>
              </div>
              <div class="input-field col s12 m6">
                  <select name="certCatDropdown">
                    <option value="0">Select One</option>
                    {{#each certificateCategories}}
                      {{> category}}
                    {{/each}}
                  </select>
                  <label>Preset</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s12 m12">
                {{> fileInput}}
              </div>
            </div>
            <div class="row">
              {{> dateInput}}
            </div>

            <div class="row">
              {{> descriptionInput}}
            </div>

            <div class="row">
              <button id="createCert" onClick="tierionPost(this.form)" class="btn-large waves-light waves-effect">Create Certificate</button>
            </div>

            <canvas id="myCanvas" width="110" height="150"></canvas>

            {{> floatingButtonCreateCertificate}}
        </form>
    </div>
  </div>
  <script>

function post(path, params, method) {
    method = method || "post"; // Set method to post by default if not specified.

    // The rest of this code assumes you are not using a library.
    // It can be made less wordy if you use one.
    var form = document.createElement("form");
    form.setAttribute("method", method);
    form.setAttribute("action", path);

    for(var key in params) {
        if(params.hasOwnProperty(key)) {
            var hiddenField = document.createElement("input");
            hiddenField.setAttribute("type", "hidden");
            hiddenField.setAttribute("name", key);
            hiddenField.setAttribute("value", params[key]);

            form.appendChild(hiddenField);
         }
    }

    document.body.appendChild(form);
    form.submit();
}

function validateForm() {
    var valid = true;
    var x = document.forms["registerForm"]["receiverKey"].value;
    var y = document.forms["registerForm"]["title"].value;
    var z = document.forms["registerForm"]["date"].value;
    if (x == null || x == "") {
        alert("Receiver key must be filled out");
        valid = false;
    }
    if (y == null || y == "") {
        alert("Title must be filled out");
        valid = false;
    }
    if (z == null || z == "") {
        alert("Date must be filled out");
        valid = false;
    }
    if(!valid){
      return false;
    }
    return true;
}

function tierionPost(form){
  //if(validateForm()){
    var path = "https://tierion.com/form/submit";
    var dataKey = "vzrEFFrDUUCIvJdEugZq8A";
    //reading values from form
    var receiverKeyVal = form.publicKeyGuest.value;
    var authorityKeyVal = form.publicKeyHost.value;
    var signatureVal = "bcf81fd1412a2136d2bef812798d2e6a394c6fe434988ed592e8f666fc5c5eaf4550f25ca71e5369dc5a987f4d8db9cbd6cd16c36268aec64b77ad2eed900efc";
    var titleVal = form.certTitleDropdown.value;
    var dateVal = Date();

    //if(confirm("You are about to certificate the public key: " + receiverKeyVal
          //+ " on the title of: " + title + " generated on: " + dateVal)){
      //alert(receiverKeyVal + ":" + authorityKeyVal + ":" + titleVal + ":" + signatureVal +":" + dateVal);
    //}
    //*/
    post(path, {
        _key: dataKey,
        authorityKey: authorityKeyVal,
        receiverKey: receiverKeyVal,
        signature: signatureVal,
        title: titleVal,
        date: dateVal});
        //*/
  //}
}

</script>
</template>

<template name="publicKeyInput">
  <div class="input-field col s12 m6">
      <input disabled type="text" id="publicKeyHost" class="validate" name="publicKeyHost" value="{{public_key}}" />
      <label for="publicKeyHost" class="active">Your Public Key</label>
  </div>
  <div class="input-field col s12 m6">
      <input type="text" id="publicKeyGuest" class="validate" name="publicKeyGuest" />
      <label for="publicKeyGuest">Public Key to Certify</label>
  </div>
</template>

<template name="privateKeyInput">
  <div class="input-field col s12 m12">
      <input type="text" id="privateKeyHost" class="validate" name="privateKeyHost" />
      <label for="privateKeyHost">Private Key to Sign</label>
  </div>
</template>

<template name="certificateTemplate">
  <option value="{{title}}">{{title}}</option>
</template>


<template name="category">
  <option value="{{category}}">{{category}}</option>
</template>

<template name="dateInput">
  <div hidden class="input-field col s12 m6 date-wrapper">
      <input type="date" class="datepicker" name="fromDate">
      <label>From</label>
  </div>
  <div hidden class="input-field col s12 m6 date-wrapper">
      <input type="date" class="datepicker" name="toDate">
      <label>To</label>
  </div>
</template>

<template name="descriptionInput">
  <div hidden class="input-field col s12 description-wrapper">
    <textarea name="certDescription" class="materialize-textarea" id="certDescription"></textarea>
    <label for="certDescription">Detailed Description</label>
  </div>
</template>

<template name="floatingButtonCreateCertificate">
  <div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
    <a class="btn-floating btn-large">
      <i class="material-icons">add</i>
    </a>
    <ul>
      <li>
        <a class="btn-floating date-btn add tooltipped" data-position="left" data-delay="50" data-tooltip="Add Date Begin and Expiry"><i class="material-icons" id="date-icon">date_range</i></a>
      </li>
      <li>
        <a class="btn-floating description-btn add tooltipped" data-position="left" data-delay="50" data-tooltip="Add Certification Description"><i class="material-icons" id="desc-icon">insert_comment</i></a>
      </li>
    </ul>
  </div>
</template>

<template name="nav">
  <nav class="blue darken-2">
    <div class="nav-wrapper">

      <a href="/" class="brand-logo">Certex</a>
      <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>
      <ul class="right hide-on-med-and-down">
        <li>{{>loginButtons}}</li>
        <li><a href="/explore">Explore</a></li>
        <li><a href="/create_certificate">Certify</a></li>
      </ul>
      <ul class="side-nav" id="mobile-demo">
        <li>{{>loginButtons}}</li>
        <li><a href="/explore">Explore</a></li>
        <li><a href="/create_certificate">Certify</a></li>
      </ul>

    </div>
  </nav>
</template>


<template name="explore">
  {{> nav}}
   <div class="container">
      <h2>Explore Certificates</h2>
     {{> search}}
     {{#each certificates}}
        {{> certificateCard}}
     {{/each}}
  </div>
</template>

<template name="search">
  <div class="row">
        <form id="searchForm">
    <div class="col s12 m6">
      <nav style="color: #212121;">
        <div class="nav-wrapper">
            <div class="input-field white">
              <input id="searchAuthorizer" name="searchAuthorizer" type="search" placeholder="Search Authorizer Public Key">
              <label for="searchAuthorizer"><i class="material-icons" style="color: #444">search</i></label>
              <i class="material-icons">close</i>
            </div>
        </div>
      </nav>
    </div>
    <div class="col s12 m6">
      <nav style="color: #212121;">
        <div class="nav-wrapper">
            <div class="input-field white">
              <input id="searchIndividual" name="searchIndividual" type="search" placeholder="Search Individual Public Key">
              <label for="searchIndividual"><i class="material-icons" style="color: #444">search</i></label>
              <i class="material-icons">close</i>
            </div>
        </div>
      </nav>

    </div>
          <hr style="border: 1px solid white;">
          <hr style="border: 1px solid white;">
          <button class="btn waves-effect waves-light" type="submit" name="action">Search
          </button>
        </form>
  </div>
</template>

<template name="fileInput">
    <div class="file-field input-field">
      <div class="btn">
        <span>Upload File</span>
        <input type="file" id="img" name="">
      </div>
      <div class="file-path-wrapper">
        <input class="file-path validate" type="text" name="certificatePhoto">
      </div>
    </div>
</template>

<template name="certificateCard">
  <div class="card">
    <div class="row">
      <div class="col s4 m2">
        <img class="responsive-img img-thumbnail" src="https://c1.staticflickr.com/5/4112/5170590074_714d36db83_b.jpg" alt="">
      </div>
      <div class="col s8 m10">
        <div class="card-content">
          <div class="row">
            <div class="col s6 m3">
              <span class="card-title activator grey-text text-darken-4">{{title}}</span>
              <p>{{#if category}}{{category}}{{/if}}</p>
            </div>
            <div class="col s6 m9">
              <p><b>Details:</b> {{description}}</p>
              <p>Expires: {{expiry_date}}</p>
              <p>Fecha Expedida: {{date_created}}</p>
              <p>Firma Digital: {{firma_dig}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</template>

<template name="registerAuthority">
    {{>nav}}

  <div class="container">
    <h2>Register Authority</h2>
    <div class="row">
        <form class="new-cert col s12">
            <div class="row">
              {{> authNameInput}}

              {{> authRFCInput}}
            </div>
            <div class="row">
              {{> authEmailInput}}

              {{> authPasswordInput}}
            </div>
            <div class="row">
                {{> authPhoneInput}}
            </div>

            <div class="row">
              <button id="registerAuth" class="btn-large waves-light waves-effect blue darken-2">Register Authority <i class="material-icons right">send</i></button>
            </div>
        </form>
    </div>
  </div>
</template>

<template name="authNameInput">
  <div class="input-field col s12 m6">
      <input type="text" id="authName" class="validate" name="authName"/>
      <label for="authName">Authority Name</label>
  </div>
</template>

<template name="authRFCInput">
  <div class="input-field col s12 m6">
      <input type="text" id="authRFC" class="validate" name="authRFC"/>
      <label for="authRFC">Authority RFC</label>
  </div>
</template>

<template name="authEmailInput">
  <div class="input-field col s12 m6">
      <input type="text" id="authEmail" class="validate" name="authEmail"/>
      <label for="authEmail">Authority Contact Email</label>
  </div>
</template>

<template name="authPasswordInput">
  <div class="input-field col s12 m6">
      <input type="password" id="authPassword" class="validate" name="authPassword"/>
      <label for="authPassword">Authority Password</label>
  </div>
</template>

<template name="authPhoneInput">
  <div class="input-field col s12 m6">
      <input type="tel" id="authPhone" class="validate" name="authPhone"/>
      <label for="authPhone">Authority Contact Phone</label>
  </div>
</template>

<template name="registerIndividual">
    {{>nav}}

  <div class="container">
    <h2>Register Individual</h2>
    <div class="row">
        <form class="new-cert col s12">
            <div class="row">
              {{> individualNameInput}}

              {{> individualCURPInput}}
            </div>
            <div class="row">
              {{> individualEmailInput}}

              {{> individualPasswordInput}}
            </div>
            <div class="row">
                {{> individualPhotoInput}}
            </div>

            <div class="row">
              <button id="registerIndividual" class="btn-large waves-light waves-effect blue darken-2">Register Individual <i class="material-icons right">send</i></button>
            </div>
        </form>
    </div>
  </div>
</template>

<template name="individualNameInput">
  <div class="input-field col s12 m6">
      <input type="text" id="individualName" class="validate" name="individualName"/>
      <label for="individualName">Individual Name</label>
  </div>
</template>

<template name="individualCURPInput">
  <div class="input-field col s12 m6">
      <input type="text" id="individualCURP" class="validate" name="individualCURP"/>
      <label for="individualCURP">Individual CURP</label>
  </div>
</template>

<template name="individualEmailInput">
  <div class="input-field col s12 m6">
      <input type="text" id="individualEmail" class="validate" name="individualEmail"/>
      <label for="individualEmail">Individual Email</label>
  </div>
</template>

<template name="individualPasswordInput">
  <div class="input-field col s12 m6">
      <input type="password" id="individualPassword" class="validate" name="individualPassword"/>
      <label for="individualPassword">Individual Password</label>
  </div>
</template>

<template name="individualPhotoInput">
  <div class="input-field col s12 m6">
    <div class="file-field input-field">
      <div class="btn">
        <span>Upload File</span>
        <input type="file" id="img" name="">
      </div>
      <div class="file-path-wrapper">
        <input class="file-path validate" type="text" name="individualPhoto">
      </div>
    </div>
  </div>
</template>
